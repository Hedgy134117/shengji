import{s as Ce,n as D,o as Te}from"../chunks/scheduler.CQ0VQmrD.js";import{S as Ne,i as De,s as S,e as m,n as Oe,d as g,f as C,c as _,a as T,w as F,k as p,g as J,h as i,l as ae,t as re,b as ie,j as Le,x as pe,y as Ie}from"../chunks/index.DRkjVt1f.js";import{a as ke,c as Pe,d as we,P as R,b as ne,T as xe,h as je,e as W,u as Ae,G as Ge}from"../chunks/GameList.Dm-SxhZe.js";const Me=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Se(n){return JSON.parse(JSON.stringify(Object.fromEntries(n)))}async function qe(n){let e=Se(n);return ke(Pe(ne,"players"),{name:e.name,level:e.level,prestige:e.prestige})}function Fe(n){var t;let e=Se(n),a=e.date;delete e.date;let l=[],r=[],c=[];for(let[s,d]of Object.entries(e))s.endsWith("-score")||s.endsWith("-stage")?s.endsWith("-score")&&r.push(d):(l.push(we(ne,`players/${(t=R.getPlayerByName(s))==null?void 0:t.id}`)),Object.keys(e).indexOf(`${s}-stage`)==-1?c.push(!1):c.push(!0));return ke(Pe(ne,"games"),{date:xe.fromDate(new Date(a)),players:l,scores:r,staged:c})}const{document:me}=Me;function _e(n,e,a){const l=n.slice();return l[3]=e[a],l}function ge(n,e,a){const l=n.slice();return l[3]=e[a],l}function ve(n,e,a){const l=n.slice();return l[3]=e[a],l}function Ue(n){return{c:D,l:D,m:D,p:D,d:D}}function Be(n){let e,a=W(R.players),l=[];for(let r=0;r<a.length;r+=1)l[r]=be(ve(n,a,r));return{c(){for(let r=0;r<l.length;r+=1)l[r].c();e=pe()},l(r){for(let c=0;c<l.length;c+=1)l[c].l(r);e=pe()},m(r,c){for(let t=0;t<l.length;t+=1)l[t]&&l[t].m(r,c);J(r,e,c)},p(r,c){if(c&4){a=W(R.players);let t;for(t=0;t<a.length;t+=1){const s=ve(r,a,t);l[t]?l[t].p(s,c):(l[t]=be(s),l[t].c(),l[t].m(e.parentNode,e))}for(;t<l.length;t+=1)l[t].d(1);l.length=a.length}},d(r){r&&g(e),ae(l,r)}}}function be(n){let e,a,l,r=n[3].name+"",c,t,s,d,L,v;return{c(){e=m("li"),a=m("label"),l=m("span"),c=re(r),t=S(),s=m("input"),d=S(),this.h()},l(E){e=_(E,"LI",{});var y=T(e);a=_(y,"LABEL",{for:!0});var f=T(a);l=_(f,"SPAN",{});var u=T(l);c=ie(u,r),u.forEach(g),f.forEach(g),t=C(y),s=_(y,"INPUT",{type:!0,id:!0,name:!0}),d=C(y),y.forEach(g),this.h()},h(){p(a,"for",n[3].id),p(s,"type","checkbox"),p(s,"id",n[3].id),p(s,"name",n[3].name)},m(E,y){J(E,e,y),i(e,a),i(a,l),i(l,c),i(e,t),i(e,s),i(e,d),L||(v=Ie(s,"change",n[2]),L=!0)},p:D,d(E){E&&g(e),L=!1,v()}}}function He(n){return{c:D,l:D,m:D,p:D,d:D}}function Ee(n){let e,a,l,r=n[3].name+"",c,t,s,d,L,v,E,y;return{c(){e=m("li"),a=m("label"),l=m("span"),c=re(r),s=S(),d=m("input"),y=S(),this.h()},l(f){e=_(f,"LI",{});var u=T(e);a=_(u,"LABEL",{for:!0});var N=T(a);l=_(N,"SPAN",{});var O=T(l);c=ie(O,r),O.forEach(g),N.forEach(g),s=C(u),d=_(u,"INPUT",{type:!0,id:!0,name:!0}),y=C(u),u.forEach(g),this.h()},h(){p(a,"for",t=n[3].id+"-score"),p(d,"type","number"),p(d,"id",L=n[3].id+"-score"),p(d,"name",v=n[3].name+"-score"),d.value=E=n[3].getScore(),d.required=!0},m(f,u){J(f,e,u),i(e,a),i(a,l),i(l,c),i(e,s),i(e,d),i(e,y)},p(f,u){u&1&&r!==(r=f[3].name+"")&&Le(c,r),u&1&&t!==(t=f[3].id+"-score")&&p(a,"for",t),u&1&&L!==(L=f[3].id+"-score")&&p(d,"id",L),u&1&&v!==(v=f[3].name+"-score")&&p(d,"name",v),u&1&&E!==(E=f[3].getScore())&&d.value!==E&&(d.value=E)},d(f){f&&g(e)}}}function ye(n){let e,a,l,r=n[3].name+"",c,t,s,d,L,v,E,y;return{c(){e=m("li"),a=m("label"),l=m("span"),c=re(r),s=S(),d=m("input"),y=S(),this.h()},l(f){e=_(f,"LI",{});var u=T(e);a=_(u,"LABEL",{for:!0});var N=T(a);l=_(N,"SPAN",{});var O=T(l);c=ie(O,r),O.forEach(g),N.forEach(g),s=C(u),d=_(u,"INPUT",{type:!0,id:!0,name:!0}),y=C(u),u.forEach(g),this.h()},h(){p(a,"for",t=n[3].id+"-stage"),p(d,"type","checkbox"),p(d,"id",L=n[3].id+"-stage"),p(d,"name",v=n[3].name+"-stage"),d.checked=E=n[3].isStaged()},m(f,u){J(f,e,u),i(e,a),i(a,l),i(l,c),i(e,s),i(e,d),i(e,y)},p(f,u){u&1&&r!==(r=f[3].name+"")&&Le(c,r),u&1&&t!==(t=f[3].id+"-stage")&&p(a,"for",t),u&1&&L!==(L=f[3].id+"-stage")&&p(d,"id",L),u&1&&v!==(v=f[3].name+"-stage")&&p(d,"name",v),u&1&&E!==(E=f[3].isStaged())&&(d.checked=E)},d(f){f&&g(e)}}}function ze(n){let e,a,l,r='<h1>add player</h1> <p><label for="name"><span>Name:</span></label> <input type="text" name="name" id="name" required=""/></p> <p><label for="level"><span>Level:</span></label> <input type="number" name="level" id="level" value="2" required=""/></p> <p><label for="prestige"><span>Prestige:</span></label> <input type="number" name="prestige" id="prestige" value="0" required=""/></p> <p><button type="submit">add</button></p>',c,t,s,d="record game",L,v,E="Date:",y,f,u,N,O,oe="Players",X,x,Y,j,U,se="Scores",Z,A,ee,G,B,de="Staged",te,M,le,H,ue='<button type="submit">record</button>',I={ctx:n,current:null,token:null,hasCatch:!1,pending:He,then:Be,catch:Ue};je(n[1](),I);let z=W(n[0]),k=[];for(let h=0;h<z.length;h+=1)k[h]=Ee(ge(n,z,h));let $=W(n[0]),P=[];for(let h=0;h<$.length;h+=1)P[h]=ye(_e(n,$,h));return{c(){e=S(),a=m("main"),l=m("form"),l.innerHTML=r,c=S(),t=m("form"),s=m("h1"),s.textContent=d,L=S(),v=m("label"),v.textContent=E,y=S(),f=m("input"),u=S(),N=m("fieldset"),O=m("legend"),O.textContent=oe,X=S(),x=m("ul"),I.block.c(),Y=S(),j=m("fieldset"),U=m("legend"),U.textContent=se,Z=S(),A=m("ul");for(let h=0;h<k.length;h+=1)k[h].c();ee=S(),G=m("fieldset"),B=m("legend"),B.textContent=de,te=S(),M=m("ul");for(let h=0;h<P.length;h+=1)P[h].c();le=S(),H=m("p"),H.innerHTML=ue,this.h()},l(h){Oe("svelte-1b6f4m5",me.head).forEach(g),e=C(h),a=_(h,"MAIN",{});var o=T(a);l=_(o,"FORM",{method:!0,id:!0,"data-svelte-h":!0}),F(l)!=="svelte-ezu4wc"&&(l.innerHTML=r),c=C(o),t=_(o,"FORM",{method:!0,id:!0});var b=T(t);s=_(b,"H1",{"data-svelte-h":!0}),F(s)!=="svelte-v9j2fd"&&(s.textContent=d),L=C(b),v=_(b,"LABEL",{for:!0,"data-svelte-h":!0}),F(v)!=="svelte-1mfsj80"&&(v.textContent=E),y=C(b),f=_(b,"INPUT",{type:!0,name:!0,id:!0}),u=C(b),N=_(b,"FIELDSET",{});var K=T(N);O=_(K,"LEGEND",{"data-svelte-h":!0}),F(O)!=="svelte-14tiku8"&&(O.textContent=oe),X=C(K),x=_(K,"UL",{id:!0});var ce=T(x);I.block.l(ce),ce.forEach(g),K.forEach(g),Y=C(b),j=_(b,"FIELDSET",{});var Q=T(j);U=_(Q,"LEGEND",{"data-svelte-h":!0}),F(U)!=="svelte-1b71l1n"&&(U.textContent=se),Z=C(Q),A=_(Q,"UL",{id:!0});var fe=T(A);for(let q=0;q<k.length;q+=1)k[q].l(fe);fe.forEach(g),Q.forEach(g),ee=C(b),G=_(b,"FIELDSET",{});var V=T(G);B=_(V,"LEGEND",{"data-svelte-h":!0}),F(B)!=="svelte-xul9i6"&&(B.textContent=de),te=C(V),M=_(V,"UL",{id:!0});var he=T(M);for(let q=0;q<P.length;q+=1)P[q].l(he);he.forEach(g),V.forEach(g),le=C(b),H=_(b,"P",{"data-svelte-h":!0}),F(H)!=="svelte-3vltf7"&&(H.innerHTML=ue),b.forEach(g),o.forEach(g),this.h()},h(){me.title="shengji record",p(l,"method","POST"),p(l,"id","recordPlayer"),p(v,"for","date"),p(f,"type","datetime-local"),p(f,"name","date"),p(f,"id","date"),p(x,"id","playerList"),p(A,"id","scoreList"),p(M,"id","stageList"),p(t,"method","POST"),p(t,"id","recordGame")},m(h,w){J(h,e,w),J(h,a,w),i(a,l),i(a,c),i(a,t),i(t,s),i(t,L),i(t,v),i(t,y),i(t,f),i(t,u),i(t,N),i(N,O),i(N,X),i(N,x),I.block.m(x,I.anchor=null),I.mount=()=>x,I.anchor=null,i(t,Y),i(t,j),i(j,U),i(j,Z),i(j,A);for(let o=0;o<k.length;o+=1)k[o]&&k[o].m(A,null);i(t,ee),i(t,G),i(G,B),i(G,te),i(G,M);for(let o=0;o<P.length;o+=1)P[o]&&P[o].m(M,null);i(t,le),i(t,H)},p(h,[w]){if(n=h,Ae(I,n,w),w&1){z=W(n[0]);let o;for(o=0;o<z.length;o+=1){const b=ge(n,z,o);k[o]?k[o].p(b,w):(k[o]=Ee(b),k[o].c(),k[o].m(A,null))}for(;o<k.length;o+=1)k[o].d(1);k.length=z.length}if(w&1){$=W(n[0]);let o;for(o=0;o<$.length;o+=1){const b=_e(n,$,o);P[o]?P[o].p(b,w):(P[o]=ye(b),P[o].c(),P[o].m(M,null))}for(;o<P.length;o+=1)P[o].d(1);P.length=$.length}},i:D,o:D,d(h){h&&(g(e),g(a)),I.block.d(),I.token=null,I=null,ae(k,h),ae(P,h)}}}function $e(n,e,a){async function l(){return await R.initialize(),Ge.initialize()}let r=[];function c(t){const s=R.getPlayerById(t.target.id);if(s!==null){if(r.indexOf(s)>=0){r.splice(r.indexOf(s),1),a(0,r);return}a(0,r=[...r,s])}}return Te(()=>{var t,s;(t=document.querySelector("#recordPlayer"))==null||t.addEventListener("submit",d=>{d.preventDefault(),qe(new FormData(d.target))}),(s=document.querySelector("#recordGame"))==null||s.addEventListener("submit",d=>{d.preventDefault(),Fe(new FormData(d.target))})}),[r,l,c]}class Ke extends Ne{constructor(e){super(),De(this,e,$e,ze,Ce,{})}}export{Ke as component};
