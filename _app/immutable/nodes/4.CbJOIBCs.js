import{s as _e,n as O,o as ge}from"../chunks/scheduler.CQ0VQmrD.js";import{S as ve,i as be,s as P,e as m,n as ye,d as y,f as S,c as h,a as N,w as z,k as i,g as K,h as r,l as de,t as Z,b as $,x as fe,j as ae,y as ne}from"../chunks/index.Dqynesj2.js";import{a as pe,c as me,d as Ee,P as J,b as ee,T as ke,h as Le,e as X,u as Pe,s as se,G as Se}from"../chunks/GameList.Bd8kArY9.js";import{g as Ce}from"../chunks/globals.D0QH3NT1.js";function he(s){return JSON.parse(JSON.stringify(Object.fromEntries(s)))}async function Te(s){let e=he(s);return pe(me(ee,"players"),{name:e.name,level:e.level,prestige:e.prestige})}function Ne(s){var a;let e=he(s),t=e.date;delete e.date;let l=[],n=[],o=[];for(let c of Object.keys(e))c.endsWith("-score")||c.endsWith("-stage")||(l.push(Ee(ee,`players/${(a=J.getPlayerByName(c))==null?void 0:a.id}`)),Object.keys(e).indexOf(`${c}-stage`)==-1?o.push(!1):o.push(!0),n.push(e[`${c}-score`]));return pe(me(ee,"games"),{date:ke.fromDate(new Date(t)),players:l,scores:n,staged:o})}const{document:re}=Ce;function ie(s,e,t){const l=s.slice();return l[5]=e[t],l[7]=t,l}function oe(s,e,t){const l=s.slice();return l[5]=e[t],l}function Oe(s){return{c:O,l:O,m:O,p:O,d:O}}function De(s){let e,t=X(J.players),l=[];for(let n=0;n<t.length;n+=1)l[n]=ce(oe(s,t,n));return{c(){for(let n=0;n<l.length;n+=1)l[n].c();e=ne()},l(n){for(let o=0;o<l.length;o+=1)l[o].l(n);e=ne()},m(n,o){for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(n,o);K(n,e,o)},p(n,o){if(o&8){t=X(J.players);let a;for(a=0;a<t.length;a+=1){const c=oe(n,t,a);l[a]?l[a].p(c,o):(l[a]=ce(c),l[a].c(),l[a].m(e.parentNode,e))}for(;a<l.length;a+=1)l[a].d(1);l.length=t.length}},d(n){n&&y(e),de(l,n)}}}function ce(s){let e,t,l,n,o,a=s[5].name+"",c,v,f,d;return{c(){e=m("li"),t=m("input"),l=P(),n=m("label"),o=m("span"),c=Z(a),v=P(),this.h()},l(T){e=h(T,"LI",{class:!0});var k=N(e);t=h(k,"INPUT",{type:!0,id:!0,name:!0,class:!0}),l=S(k),n=h(k,"LABEL",{for:!0,class:!0});var p=N(n);o=h(p,"SPAN",{});var w=N(o);c=$(w,a),w.forEach(y),p.forEach(y),v=S(k),k.forEach(y),this.h()},h(){i(t,"type","checkbox"),i(t,"id",s[5].id),i(t,"name",s[5].name),i(t,"class","svelte-4mye3g"),i(n,"for",s[5].id),i(n,"class","clickable-label svelte-4mye3g"),i(e,"class","svelte-4mye3g")},m(T,k){K(T,e,k),r(e,t),r(e,l),r(e,n),r(n,o),r(o,c),r(e,v),f||(d=fe(t,"change",s[3]),f=!0)},p:O,d(T){T&&y(e),f=!1,d()}}}function Ie(s){return{c:O,l:O,m:O,p:O,d:O}}function ue(s){let e,t,l,n,o,a,c,v,f=s[5].name+"",d,T,k,p,w,D,I,U,q,C=se(s[1][s[7]])+"",B,j,G,R;return{c(){e=m("li"),t=m("input"),a=P(),c=m("label"),v=m("span"),d=Z(f),k=P(),p=m("input"),U=P(),q=m("p"),B=Z(C),j=P(),this.h()},l(g){e=h(g,"LI",{class:!0});var u=N(e);t=h(u,"INPUT",{type:!0,id:!0,name:!0,class:!0}),a=S(u),c=h(u,"LABEL",{for:!0,class:!0});var H=N(c);v=h(H,"SPAN",{});var A=N(v);d=$(A,f),A.forEach(y),H.forEach(y),k=S(u),p=h(u,"INPUT",{type:!0,id:!0,name:!0,class:!0}),U=S(u),q=h(u,"P",{class:!0});var W=N(q);B=$(W,C),W.forEach(y),j=S(u),u.forEach(y),this.h()},h(){i(t,"type","checkbox"),i(t,"id",l=s[5].id+"-stage"),i(t,"name",n=s[5].name+"-stage"),t.checked=o=s[5].isStaged(),i(t,"class","svelte-4mye3g"),i(c,"for",T=s[5].id+"-stage"),i(c,"class","clickable-label svelte-4mye3g"),i(p,"type","number"),i(p,"id",w=s[5].id+"-score"),i(p,"name",D=s[5].name+"-score"),p.value=I=s[1][s[7]],p.required=!0,i(p,"class","svelte-4mye3g"),i(q,"class","score-value svelte-4mye3g"),i(e,"class","svelte-4mye3g")},m(g,u){K(g,e,u),r(e,t),r(e,a),r(e,c),r(c,v),r(v,d),r(e,k),r(e,p),r(e,U),r(e,q),r(q,B),r(e,j),G||(R=fe(p,"change",s[4]),G=!0)},p(g,u){u&1&&l!==(l=g[5].id+"-stage")&&i(t,"id",l),u&1&&n!==(n=g[5].name+"-stage")&&i(t,"name",n),u&1&&o!==(o=g[5].isStaged())&&(t.checked=o),u&1&&f!==(f=g[5].name+"")&&ae(d,f),u&1&&T!==(T=g[5].id+"-stage")&&i(c,"for",T),u&1&&w!==(w=g[5].id+"-score")&&i(p,"id",w),u&1&&D!==(D=g[5].name+"-score")&&i(p,"name",D),u&2&&I!==(I=g[1][g[7]])&&p.value!==I&&(p.value=I),u&2&&C!==(C=se(g[1][g[7]])+"")&&ae(B,C)},d(g){g&&y(e),G=!1,R()}}}function we(s){let e,t,l,n='<h1>add player</h1> <p><label for="name"><span>Name:</span></label> <input type="text" name="name" id="name" required="" class="svelte-4mye3g"/></p> <p><label for="level"><span>Level:</span></label> <input type="number" name="level" id="level" value="2" required="" class="svelte-4mye3g"/></p> <p><label for="prestige"><span>Prestige:</span></label> <input type="number" name="prestige" id="prestige" value="0" required="" class="svelte-4mye3g"/></p> <p><button type="submit">add</button></p>',o,a,c,v="record game",f,d,T="Date:",k,p,w,D,I,U="Players",q,C,B,j,G,R="Scores",g,u,H,A,W='<button type="submit">record</button>',M={ctx:s,current:null,token:null,hasCatch:!1,pending:Ie,then:De,catch:Oe};Le(s[2](),M);let x=X(s[0]),E=[];for(let b=0;b<x.length;b+=1)E[b]=ue(ie(s,x,b));return{c(){e=P(),t=m("main"),l=m("form"),l.innerHTML=n,o=P(),a=m("form"),c=m("h1"),c.textContent=v,f=P(),d=m("label"),d.textContent=T,k=P(),p=m("input"),w=P(),D=m("fieldset"),I=m("legend"),I.textContent=U,q=P(),C=m("ul"),M.block.c(),B=P(),j=m("fieldset"),G=m("legend"),G.textContent=R,g=P(),u=m("ul");for(let b=0;b<E.length;b+=1)E[b].c();H=P(),A=m("p"),A.innerHTML=W,this.h()},l(b){ye("svelte-1b6f4m5",re.head).forEach(y),e=S(b),t=h(b,"MAIN",{});var _=N(t);l=h(_,"FORM",{method:!0,id:!0,"data-svelte-h":!0}),z(l)!=="svelte-ezu4wc"&&(l.innerHTML=n),o=S(_),a=h(_,"FORM",{method:!0,id:!0});var L=N(a);c=h(L,"H1",{"data-svelte-h":!0}),z(c)!=="svelte-v9j2fd"&&(c.textContent=v),f=S(L),d=h(L,"LABEL",{for:!0,"data-svelte-h":!0}),z(d)!=="svelte-1mfsj80"&&(d.textContent=T),k=S(L),p=h(L,"INPUT",{type:!0,name:!0,id:!0,class:!0}),w=S(L),D=h(L,"FIELDSET",{});var Q=N(D);I=h(Q,"LEGEND",{"data-svelte-h":!0}),z(I)!=="svelte-14tiku8"&&(I.textContent=U),q=S(Q),C=h(Q,"UL",{id:!0,class:!0});var te=N(C);M.block.l(te),te.forEach(y),Q.forEach(y),B=S(L),j=h(L,"FIELDSET",{});var V=N(j);G=h(V,"LEGEND",{"data-svelte-h":!0}),z(G)!=="svelte-1b71l1n"&&(G.textContent=R),g=S(V),u=h(V,"UL",{id:!0,class:!0});var le=N(u);for(let Y=0;Y<E.length;Y+=1)E[Y].l(le);le.forEach(y),V.forEach(y),H=S(L),A=h(L,"P",{"data-svelte-h":!0}),z(A)!=="svelte-3vltf7"&&(A.innerHTML=W),L.forEach(y),_.forEach(y),this.h()},h(){re.title="shengji record",i(l,"method","POST"),i(l,"id","recordPlayer"),i(d,"for","date"),i(p,"type","datetime-local"),i(p,"name","date"),i(p,"id","date"),i(p,"class","svelte-4mye3g"),i(C,"id","playerList"),i(C,"class","wrap-list svelte-4mye3g"),i(u,"id","scoreList"),i(u,"class","wrap-list wrap-list--center svelte-4mye3g"),i(a,"method","POST"),i(a,"id","recordGame")},m(b,F){K(b,e,F),K(b,t,F),r(t,l),r(t,o),r(t,a),r(a,c),r(a,f),r(a,d),r(a,k),r(a,p),r(a,w),r(a,D),r(D,I),r(D,q),r(D,C),M.block.m(C,M.anchor=null),M.mount=()=>C,M.anchor=null,r(a,B),r(a,j),r(j,G),r(j,g),r(j,u);for(let _=0;_<E.length;_+=1)E[_]&&E[_].m(u,null);r(a,H),r(a,A)},p(b,[F]){if(s=b,Pe(M,s,F),F&19){x=X(s[0]);let _;for(_=0;_<x.length;_+=1){const L=ie(s,x,_);E[_]?E[_].p(L,F):(E[_]=ue(L),E[_].c(),E[_].m(u,null))}for(;_<E.length;_+=1)E[_].d(1);E.length=x.length}},i:O,o:O,d(b){b&&(y(e),y(t)),M.block.d(),M.token=null,M=null,de(E,b)}}}function je(s,e,t){async function l(){return await J.initialize(),Se.initialize()}let n=[],o=[];function a(v){const f=J.getPlayerById(v.target.id);if(f!==null){if(n.indexOf(f)>=0){const d=n.indexOf(f);n.splice(d,1),t(0,n),o.splice(d,1),t(1,o);return}t(0,n=[...n,f]),t(1,o=[...o,f.getScore()])}}function c(v){const f=J.getPlayerById(v.target.id.replace("-score",""));if(f===null)return;const d=n.indexOf(f);t(1,o[d]=parseInt(v.target.value),o)}return ge(()=>{var v,f;(v=document.querySelector("#recordPlayer"))==null||v.addEventListener("submit",d=>{d.preventDefault(),Te(new FormData(d.target))}),(f=document.querySelector("#recordGame"))==null||f.addEventListener("submit",d=>{d.preventDefault(),Ne(new FormData(d.target))})}),[n,o,l,a,c]}class Be extends ve{constructor(e){super(),be(this,e,je,we,_e,{})}}export{Be as component};
