import{s as Ae,n as J,o as Ge,r as Ve}from"../chunks/scheduler.CQ0VQmrD.js";import{S as Oe,i as je,e as m,s as E,c as p,a as I,q as Y,f as T,d as g,k as n,g as K,h as u,D as Se,r as ne,l as Ce,t as le,b as ae,j as Be,H as _e,y as ue,E as me,n as Xe,o as Ue,p as qe,u as Ye,v as Ze,w as $e,x as xe}from"../chunks/index.B_jzJh3r.js";import{a as Fe,c as Re,b as oe,G as pe,f as De,T as et,g as tt,e as re,P as ve,s as lt,h as at}from"../chunks/GameList.CipN0kEP.js";const nt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function st(t){return JSON.parse(JSON.stringify(Object.fromEntries(t)))}async function it(t){let e=st(t);return Fe(Re(oe,"players"),{name:e.name,level:e.level,prestige:e.prestige})}async function rt(t,e,l){if(e.length<4)return"Missing players";for(let i of pe.games)if(i.date.getTime()==t.getTime())return"Game already exists at this time";let a=e.map(i=>De(oe,`players/${i.id}`)),o=[],h=[];for(let i of Object.keys(l))o.push(l[i][0]),h.push(l[i][1]);if(e.length!==o.length||e.length!==h.length)return"Missing scores";const r=await Fe(Re(oe,"games"),{date:et.fromDate(new Date(t)),players:a,scores:o,staged:h});console.log(r);const d=await tt(De(oe,"games",r.id));return d.data()!==void 0&&pe.addGame(d.data()),r}function Ie(t,e,l){const a=t.slice();return a[14]=e[l],a}function He(t,e,l){const a=t.slice();return a[14]=e[l],a}function Ne(t){let e,l,a,o,h,r,d,i=t[14].name+"",L,b,S,A,C;function q(){return t[8](t[14])}return{c(){e=m("li"),l=m("input"),h=E(),r=m("label"),d=m("span"),L=le(i),S=E(),this.h()},l(D){e=p(D,"LI",{class:!0});var w=I(e);l=p(w,"INPUT",{type:!0,id:!0,name:!0,class:!0}),h=T(w),r=p(w,"LABEL",{for:!0,class:!0});var s=I(r);d=p(s,"SPAN",{});var k=I(d);L=ae(k,i),k.forEach(g),s.forEach(g),S=T(w),w.forEach(g),this.h()},h(){n(l,"type","checkbox"),n(l,"id",a=t[14].id),n(l,"name",o=t[14].name),n(l,"class","svelte-1x7fdc7"),n(r,"for",b=t[14].id),n(r,"class","clickable-label svelte-1x7fdc7"),n(e,"class","svelte-1x7fdc7")},m(D,w){K(D,e,w),u(e,l),u(e,h),u(e,r),u(r,d),u(d,L),u(e,S),A||(C=ne(l,"change",q),A=!0)},p(D,w){t=D,w&1&&a!==(a=t[14].id)&&n(l,"id",a),w&1&&o!==(o=t[14].name)&&n(l,"name",o),w&1&&i!==(i=t[14].name+"")&&Be(L,i),w&1&&b!==(b=t[14].id)&&n(r,"for",b)},d(D){D&&g(e),A=!1,C()}}}function ot(t){let e,l=t[6]([t[14].getScore(),t[14].isStaged()])+"",a;return{c(){e=new _e(!1),a=ue(),this.h()},l(o){e=me(o,!1),a=ue(),this.h()},h(){e.a=a},m(o,h){e.m(l,o,h),K(o,a,h)},p(o,h){h&2&&l!==(l=o[6]([o[14].getScore(),o[14].isStaged()])+"")&&e.p(l)},d(o){o&&(g(a),e.d())}}}function ut(t){let e,l=t[6]([t[14].getScore(),t[14].isStaged()])+"",a,o,h=t[6](t[2][t[14].id])+"",r;return{c(){e=new _e(!1),a=le(` →\r
							`),o=new _e(!1),r=ue(),this.h()},l(d){e=me(d,!1),a=ae(d,` →\r
							`),o=me(d,!1),r=ue(),this.h()},h(){e.a=a,o.a=r},m(d,i){e.m(l,d,i),K(d,a,i),o.m(h,d,i),K(d,r,i)},p(d,i){i&2&&l!==(l=d[6]([d[14].getScore(),d[14].isStaged()])+"")&&e.p(l),i&6&&h!==(h=d[6](d[2][d[14].id])+"")&&o.p(h)},d(d){d&&(e.d(),g(a),g(r),o.d())}}}function We(t){let e,l,a,o=t[14].name+"",h,r,d,i,L,b,S,A,C,q,D,w,s,k,W,F,Z,M,O,Q,R,H,V,$,j,P,N,y,_,v,f,G,x,ee,B,X,de,se,fe,te,ce,he,ge;function ze(){return t[9](t[14])}function Je(){return t[10](t[14])}function Ke(){return t[11](t[14])}function Qe(){return t[12](t[14])}function be(z,c){return z[2][z[14].id]!==void 0?ut:ot}let ie=be(t),U=ie(t);return{c(){e=m("li"),l=m("label"),a=m("span"),h=le(o),d=E(),i=m("input"),A=E(),C=m("label"),q=le("L"),w=E(),s=m("input"),Z=E(),M=m("label"),O=le("W"),R=E(),H=m("input"),P=E(),N=m("label"),y=le("WW"),v=E(),f=m("input"),B=E(),X=m("label"),de=le("WWW"),fe=E(),te=m("p"),U.c(),ce=E(),this.h()},l(z){e=p(z,"LI",{class:!0});var c=I(e);l=p(c,"LABEL",{for:!0,class:!0});var we=I(l);a=p(we,"SPAN",{});var Le=I(a);h=ae(Le,o),Le.forEach(g),we.forEach(g),d=T(c),i=p(c,"INPUT",{name:!0,id:!0,type:!0,class:!0}),A=T(c),C=p(c,"LABEL",{for:!0,class:!0});var ke=I(C);q=ae(ke,"L"),ke.forEach(g),w=T(c),s=p(c,"INPUT",{name:!0,id:!0,type:!0,class:!0}),Z=T(c),M=p(c,"LABEL",{for:!0,class:!0});var Ee=I(M);O=ae(Ee,"W"),Ee.forEach(g),R=T(c),H=p(c,"INPUT",{name:!0,id:!0,type:!0,class:!0}),P=T(c),N=p(c,"LABEL",{for:!0,class:!0});var Te=I(N);y=ae(Te,"WW"),Te.forEach(g),v=T(c),f=p(c,"INPUT",{name:!0,id:!0,type:!0,class:!0}),B=T(c),X=p(c,"LABEL",{for:!0,class:!0});var Pe=I(X);de=ae(Pe,"WWW"),Pe.forEach(g),fe=T(c),te=p(c,"P",{class:!0});var ye=I(te);U.l(ye),ye.forEach(g),ce=T(c),c.forEach(g),this.h()},h(){n(l,"for",r=t[14].id+"-stage"),n(l,"class","name unclickable-label svelte-1x7fdc7"),n(i,"name",L=t[14].id+"-result"),i.value=b=t[14].id+"-loss",n(i,"id",S=t[14].id+"-loss"),n(i,"type","radio"),n(i,"class","svelte-1x7fdc7"),n(C,"for",D=t[14].id+"-loss"),n(C,"class","result-choice clickable-label svelte-1x7fdc7"),n(s,"name",k=t[14].id+"-result"),s.value=W=t[14].id+"-win-1",n(s,"id",F=t[14].id+"-win-1"),n(s,"type","radio"),n(s,"class","svelte-1x7fdc7"),n(M,"for",Q=t[14].id+"-win-1"),n(M,"class","result-choice clickable-label svelte-1x7fdc7"),n(H,"name",V=t[14].id+"-result"),H.value=$=t[14].id+"-win-2",n(H,"id",j=t[14].id+"-win-2"),n(H,"type","radio"),n(H,"class","svelte-1x7fdc7"),n(N,"for",_=t[14].id+"-win-2"),n(N,"class","result-choice clickable-label svelte-1x7fdc7"),n(f,"name",G=t[14].id+"-result"),f.value=x=t[14].id+"-win-3",n(f,"id",ee=t[14].id+"-win-3"),n(f,"type","radio"),n(f,"class","svelte-1x7fdc7"),n(X,"for",se=t[14].id+"-win-3"),n(X,"class","result-choice clickable-label svelte-1x7fdc7"),n(te,"class","unclickable-label result svelte-1x7fdc7"),n(e,"class","score svelte-1x7fdc7")},m(z,c){K(z,e,c),u(e,l),u(l,a),u(a,h),u(e,d),u(e,i),u(e,A),u(e,C),u(C,q),u(e,w),u(e,s),u(e,Z),u(e,M),u(M,O),u(e,R),u(e,H),u(e,P),u(e,N),u(N,y),u(e,v),u(e,f),u(e,B),u(e,X),u(X,de),u(e,fe),u(e,te),U.m(te,null),u(e,ce),he||(ge=[ne(i,"change",ze),ne(s,"change",Je),ne(H,"change",Ke),ne(f,"change",Qe)],he=!0)},p(z,c){t=z,c&2&&o!==(o=t[14].name+"")&&Be(h,o),c&2&&r!==(r=t[14].id+"-stage")&&n(l,"for",r),c&2&&L!==(L=t[14].id+"-result")&&n(i,"name",L),c&2&&b!==(b=t[14].id+"-loss")&&(i.value=b),c&2&&S!==(S=t[14].id+"-loss")&&n(i,"id",S),c&2&&D!==(D=t[14].id+"-loss")&&n(C,"for",D),c&2&&k!==(k=t[14].id+"-result")&&n(s,"name",k),c&2&&W!==(W=t[14].id+"-win-1")&&(s.value=W),c&2&&F!==(F=t[14].id+"-win-1")&&n(s,"id",F),c&2&&Q!==(Q=t[14].id+"-win-1")&&n(M,"for",Q),c&2&&V!==(V=t[14].id+"-result")&&n(H,"name",V),c&2&&$!==($=t[14].id+"-win-2")&&(H.value=$),c&2&&j!==(j=t[14].id+"-win-2")&&n(H,"id",j),c&2&&_!==(_=t[14].id+"-win-2")&&n(N,"for",_),c&2&&G!==(G=t[14].id+"-result")&&n(f,"name",G),c&2&&x!==(x=t[14].id+"-win-3")&&(f.value=x),c&2&&ee!==(ee=t[14].id+"-win-3")&&n(f,"id",ee),c&2&&se!==(se=t[14].id+"-win-3")&&n(X,"for",se),ie===(ie=be(t))&&U?U.p(t,c):(U.d(1),U=ie(t),U&&(U.c(),U.m(te,null)))},d(z){z&&g(e),U.d(),he=!1,Ve(ge)}}}function dt(t){let e,l,a="record game",o,h,r="when?",d,i,L="Date:",b,S,A,C,q="who played?",D,w,s,k,W,F="what were the results?",Z,M,O,Q,R,H='<button type="submit">record</button>',V,$,j=re(t[0]),P=[];for(let _=0;_<j.length;_+=1)P[_]=Ne(He(t,j,_));let N=re(t[1]),y=[];for(let _=0;_<N.length;_+=1)y[_]=We(Ie(t,N,_));return{c(){e=m("form"),l=m("h1"),l.textContent=a,o=E(),h=m("h2"),h.textContent=r,d=E(),i=m("label"),i.textContent=L,b=E(),S=m("input"),A=E(),C=m("h2"),C.textContent=q,D=E(),w=m("fieldset"),s=m("ul");for(let _=0;_<P.length;_+=1)P[_].c();k=E(),W=m("h2"),W.textContent=F,Z=E(),M=m("fieldset"),O=m("ul");for(let _=0;_<y.length;_+=1)y[_].c();Q=E(),R=m("p"),R.innerHTML=H,this.h()},l(_){e=p(_,"FORM",{method:!0,id:!0,class:!0});var v=I(e);l=p(v,"H1",{"data-svelte-h":!0}),Y(l)!=="svelte-v9j2fd"&&(l.textContent=a),o=T(v),h=p(v,"H2",{"data-svelte-h":!0}),Y(h)!=="svelte-1z0dykh"&&(h.textContent=r),d=T(v),i=p(v,"LABEL",{for:!0,"data-svelte-h":!0}),Y(i)!=="svelte-1mfsj80"&&(i.textContent=L),b=T(v),S=p(v,"INPUT",{type:!0,name:!0,id:!0}),A=T(v),C=p(v,"H2",{"data-svelte-h":!0}),Y(C)!=="svelte-18jthcy"&&(C.textContent=q),D=T(v),w=p(v,"FIELDSET",{});var f=I(w);s=p(f,"UL",{id:!0,class:!0});var G=I(s);for(let B=0;B<P.length;B+=1)P[B].l(G);G.forEach(g),f.forEach(g),k=T(v),W=p(v,"H2",{"data-svelte-h":!0}),Y(W)!=="svelte-24ae4t"&&(W.textContent=F),Z=T(v),M=p(v,"FIELDSET",{});var x=I(M);O=p(x,"UL",{id:!0,class:!0});var ee=I(O);for(let B=0;B<y.length;B+=1)y[B].l(ee);ee.forEach(g),x.forEach(g),Q=T(v),R=p(v,"P",{"data-svelte-h":!0}),Y(R)!=="svelte-3vltf7"&&(R.innerHTML=H),v.forEach(g),this.h()},h(){n(i,"for","date"),n(S,"type","datetime-local"),n(S,"name","date"),n(S,"id","date"),n(s,"id","playerList"),n(s,"class","wrap-list svelte-1x7fdc7"),n(O,"id","scoreList"),n(O,"class"," svelte-1x7fdc7"),n(e,"method","POST"),n(e,"id","recordGame"),n(e,"class","svelte-1x7fdc7")},m(_,v){K(_,e,v),u(e,l),u(e,o),u(e,h),u(e,d),u(e,i),u(e,b),u(e,S),Se(S,t[3]),u(e,A),u(e,C),u(e,D),u(e,w),u(w,s);for(let f=0;f<P.length;f+=1)P[f]&&P[f].m(s,null);u(e,k),u(e,W),u(e,Z),u(e,M),u(M,O);for(let f=0;f<y.length;f+=1)y[f]&&y[f].m(O,null);u(e,Q),u(e,R),V||($=ne(S,"input",t[7]),V=!0)},p(_,[v]){if(v&8&&Se(S,_[3]),v&17){j=re(_[0]);let f;for(f=0;f<j.length;f+=1){const G=He(_,j,f);P[f]?P[f].p(G,v):(P[f]=Ne(G),P[f].c(),P[f].m(s,null))}for(;f<P.length;f+=1)P[f].d(1);P.length=j.length}if(v&102){N=re(_[1]);let f;for(f=0;f<N.length;f+=1){const G=Ie(_,N,f);y[f]?y[f].p(G,v):(y[f]=We(G),y[f].c(),y[f].m(O,null))}for(;f<y.length;f+=1)y[f].d(1);y.length=N.length}},i:J,o:J,d(_){_&&g(e),Ce(P,_),Ce(y,_),V=!1,$()}}}function ft(t,e,l){let{players:a}=e,o=[];function h(s){o.includes(s)?(l(1,o=o.filter(k=>k.id!==s.id)),delete r[s.id],l(2,r)):l(1,o=[...o,s])}let r={},d={};function i(s,k){d[s.id]=k,l(2,r[s.id]=[0,!1],r),l(2,r[s.id][0]=parseInt(s.getScore()),r),l(2,r[s.id][1]=s.isStaged(),r),k===0?l(2,r[s.id][1]=!1,r):r[s.id][1]?l(2,r[s.id][0]+=k,r):(l(2,r[s.id][1]=!0,r),l(2,r[s.id][0]+=k-1,r)),r[s.id][0]>13&&l(2,r[s.id][0]-=12,r),console.log(r[s.id][0])}function L(s){let k=lt(s[0]);return s[1]?`<u>${k}</u>`:k}let b=new Date;Ge(()=>{var s;(s=document.querySelector("#recordGame"))==null||s.addEventListener("submit",async k=>{k.preventDefault();let W=await rt(new Date(b),o,r);alert(typeof W=="string"?W:"Game Recorded!"),l(1,o=[...o]);for(let F in d)i(ve.getPlayerById(F),d[F])})});function S(){b=this.value,l(3,b)}const A=s=>h(s),C=s=>i(s,0),q=s=>i(s,1),D=s=>i(s,2),w=s=>i(s,3);return t.$$set=s=>{"players"in s&&l(0,a=s.players)},[a,o,r,b,h,i,L,S,A,C,q,D,w]}class ct extends Oe{constructor(e){super(),je(this,e,ft,dt,Ae,{players:0})}}const{document:Me}=nt;function ht(t){return{c:J,l:J,m:J,i:J,o:J,d:J}}function _t(t){let e,l;return e=new ct({props:{players:ve.players}}),{c(){Ye(e.$$.fragment)},l(a){Ze(e.$$.fragment,a)},m(a,o){$e(e,a,o),l=!0},i(a){l||(Ue(e.$$.fragment,a),l=!0)},o(a){qe(e.$$.fragment,a),l=!1},d(a){xe(e,a)}}}function mt(t){let e,l="Loading Players";return{c(){e=m("p"),e.textContent=l},l(a){e=p(a,"P",{"data-svelte-h":!0}),Y(e)!=="svelte-1wsjfye"&&(e.textContent=l)},m(a,o){K(a,e,o)},i:J,o:J,d(a){a&&g(e)}}}function pt(t){let e,l,a,o='<h1>add player</h1> <p><label for="name"><span>Name:</span></label> <input type="text" name="name" id="name" required="" class="svelte-1pux4cw"/></p> <p><label for="level"><span>Level:</span></label> <input type="number" name="level" id="level" value="2" required="" class="svelte-1pux4cw"/></p> <p><label for="prestige"><span>Prestige:</span></label> <input type="number" name="prestige" id="prestige" value="0" required="" class="svelte-1pux4cw"/></p> <p><button type="submit">add</button></p>',h,r,d={ctx:t,current:null,token:null,hasCatch:!1,pending:mt,then:_t,catch:ht,blocks:[,,,]};return at(t[0](),d),{c(){e=E(),l=m("main"),a=m("form"),a.innerHTML=o,h=E(),d.block.c(),this.h()},l(i){Xe("svelte-1b6f4m5",Me.head).forEach(g),e=T(i),l=p(i,"MAIN",{});var b=I(l);a=p(b,"FORM",{method:!0,id:!0,"data-svelte-h":!0}),Y(a)!=="svelte-ezu4wc"&&(a.innerHTML=o),h=T(b),d.block.l(b),b.forEach(g),this.h()},h(){Me.title="shengji record",n(a,"method","POST"),n(a,"id","recordPlayer")},m(i,L){K(i,e,L),K(i,l,L),u(l,a),u(l,h),d.block.m(l,d.anchor=null),d.mount=()=>l,d.anchor=null,r=!0},p(i,[L]){t=i},i(i){r||(Ue(d.block),r=!0)},o(i){for(let L=0;L<3;L+=1){const b=d.blocks[L];qe(b)}r=!1},d(i){i&&(g(e),g(l)),d.block.d(),d.token=null,d=null}}}function vt(t){async function e(){return await ve.initialize(),pe.initialize()}return Ge(()=>{var l;(l=document.querySelector("#recordPlayer"))==null||l.addEventListener("submit",a=>{a.preventDefault(),it(new FormData(a.target))})}),[e]}class Lt extends Oe{constructor(e){super(),je(this,e,vt,pt,Ae,{})}}export{Lt as component};
